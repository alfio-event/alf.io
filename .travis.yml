language: java
dist: xenial
sudo: required
install:
  - TERM=dumb ./gradlew -q assemble
matrix:
  include:
    - name: postgresql 9.6
      jdk: openjdk11
      env: PROFILE="-Dspring.profiles.active=travis -Ddbenv=PGSQL-TRAVIS -Dpgsql9.6"
      addons:
        postgresql: "9.6"
    - name: postgresql 10
      jdk: openjdk11
      env: PROFILE="-Dspring.profiles.active=travis -Ddbenv=PGSQL-TRAVIS -Dpgsql10"
      addons:
        postgresql: "10"
    - name: postgresql 11
      jdk: openjdk11
      env: PROFILE="-Dspring.profiles.active=travis -Ddbenv=PGSQL-TRAVIS -Dpgsql11"
      install:
        - sudo apt-get install -yq --no-install-suggests --no-install-recommends postgresql-common
        - sudo service postgresql stop
        - sudo apt install -yq --no-install-suggests --no-install-recommends postgresql-11 postgresql-client-11
        - sudo service postgresql start 11
before_script:
  - psql -c 'create database alfio;' -U postgres
script:
  - TERM=dumb ./gradlew build jacocoTestReport $PROFILE
after_success:
  ./gradlew coveralls

<div class="container">
    <div class="page-header">
        <h1>Email Log</h1>
        <small class="text-muted">Here you can find all the e-mails generated by the current <span>{{ctrl.contextType === 'event' ? 'event' : 'subscription'}}</span></small>
    </div>


    <div class="wMarginTop wMarginBottom">
        <div class="page-header">
            <h3><i class="fa fa-envelope-o"></i> Emails</h3>
        </div>

        <div class="row">
            <div class="col-xs-12 col-md-4">
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-addon"><i class="fa fa-search"></i></div>
                        <input type="text" class="form-control" placeholder="Filter table" data-ng-model="ctrl.toSearch" ng-change="ctrl.updateFilteredData()" ng-model-options='{ debounce: 1000 }'>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="wMarginTop wMarginBottom" data-ng-if="ctrl.emailMessages.length == 0">
            <h3><i class="fa fa-close"></i> No data found.</h3>
        </div>

        <div class="table-responsive" data-ng-if="ctrl.emailMessages.length > 0">
            <table class="table">
                <thead>
                <th>Recipient</th>
                <th>Subject</th>
                <th>Message</th>
                <th>Status</th>
                <th>Checksum</th>
                <th>Requested</th>
                <th>Sent</th>
                </thead>
                <tbody>
                <tr data-ng-repeat="email in ctrl.emailMessages" data-ng-class="{'text-success': email.status === 'SENT', 'text-danger': email.status === 'ERROR', 'text-warning': email.status === 'RETRY'}">
                    <td data-ng-class-even="'active'" class="cell-wrap">{{::email.recipient}}</td>
                    <td data-ng-class-even="'active'" class="cell-wrap">{{::email.subject | truncateString}}</td>
                    <td data-ng-class-even="'active'" class="cell-wrap"><a href="#" data-ui-sref="events.single.email-log-detail({eventName: ctrl.publicIdentifier, messageId: email.id})">{{::email.message | truncateString:100}}</a></td>
                    <td data-ng-class-even="'active'" class="cell-wrap">{{::email.status}}</td>
                    <td data-ng-class-even="'active'" class="cell-wrap">{{::email.checksum | truncateString:10}}</td>
                    <td data-ng-class-even="'active'" class="cell-wrap">{{::email.requestTimestamp | formatDate}}</td>
                    <td data-ng-class-even="'active'" class="cell-wrap">{{::email.sentTimestamp | formatDate}}</td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="text-center wMarginBottom">
            <uib-pagination total-items="ctrl.totalItems" ng-model="ctrl.currentPage" ng-change="ctrl.updateFilteredData()" items-per-page="ctrl.itemsPerPage" max-size="10" force-ellipses="true"></uib-pagination>
        </div>
    </div>
    <div class="text-center wMarginBottom" data-ng-if="ctrl.contextType === 'event'">
        <a href="#" data-ui-sref="^.detail" class="btn btn-default">back</a>
    </div>
</div>
<div class="modal-header">
    <h3>Insert new {{promoCodeDescription}} code</h3>
</div>
<form name="promoCodeForm" data-ng-submit="update(promoCodeForm, promocode)" novalidate data-error-sensitive>
    <div class="modal-body">
        <div class="col-xs-12 col-md-8 col-md-offset-2" ng-if="restrictedCategories && restrictedCategories.length > 0">
            <div class="form-group">
                <label class="control-label">Code type</label>
                <div>
                    <div class="radio-inline">
                        <label>
                            <input type="radio" name="codeType" data-ng-model="promocode.codeType" data-ng-value="'DISCOUNT'" required>
                            Discount Code
                        </label>
                    </div>
                    <div class="radio-inline">
                        <label>
                            <input type="radio" name="codeType" data-ng-model="promocode.codeType" data-ng-value="'ACCESS'" required>
                            Access hidden Category
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-8 col-md-offset-2">
            <div class="form-group" bs-form-error="promocode.promoCode">
                <label for="promoCode">name (min length is 7 characters)</label>
                <input type="text" id="promoCode" data-ng-model="promocode.promoCode" class="form-control to-uppercase" required minlength="7"/>
                <field-error data-form-obj="promocode" data-field-obj="promocode.promoCode" data-show-existing-errors="showExistingErrors"></field-error>
            </div>


            <div class="form-group" bs-form-error="promocode.dateString">
                <label for="date">Validity range <span ng-if="!forEvent">(Note: these dates are in your current timezone)</span></label>
                <div class="input-group">
                    <input type="text" data-date-range data-start-model="promocode.start" min-date="true" data-end-model="promocode.end" data-ng-model="promocode.dateString" name="date" id="date" class="form-control" required />
                    <div class="input-group-addon" ng-if="forEvent">
                        <span>{{event.timeZone}}</span>
                    </div>
                </div>
                <field-error data-form-obj="promocode" data-field-obj="promocode.dateString" data-show-existing-errors="showExistingErrors"></field-error>
            </div>

            <div class="form-group" ng-if="promocode.codeType == 'DISCOUNT'">
                <label class="control-label">Discount type</label>
                <div>
                    <div class="radio-inline">
                        <label>
                            <input type="radio" name="discountType" data-ng-model="promocode.discountType" data-ng-value="'FIXED_AMOUNT'" required>
                            Fixed amount
                        </label>
                    </div>
                    <div class="radio-inline">
                        <label>
                            <input type="radio" name="discountType" data-ng-model="promocode.discountType" data-ng-value="'PERCENTAGE'" required>
                            Percentage
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-group" bs-form-error="promocode.discountAmount" ng-if="promocode.codeType == 'DISCOUNT'">
                <label for="promoCode">Discount amount</label>
                <div class="input-group">
                    <input type="number" id="discountAmount" data-ng-model="promocode.discountAmount" class="form-control" min="0" required/>
                    <div class="input-group-addon">
                        <span data-ng-if="promocode.discountType === 'PERCENTAGE'">%</span>
                        <span data-ng-if="promocode.discountType === 'FIXED_AMOUNT'">{{event.currency}}</span>
                    </div>
                </div>
                <field-error data-form-obj="discountAmount" data-field-obj="promocode.discountAmount" data-show-existing-errors="showExistingErrors"></field-error>
            </div>


            <div class="form-group" ng-if="forEvent && promocode.codeType == 'DISCOUNT'">
                <label>Restrict to categories</label>
                <ul class="list-unstyled">
                    <li ng-repeat="category in validCategories"><label><input type="checkbox" ng-true-value="{{::category.id}}" ng-false-value="null" ng-model="promocode.categories[$index]"> {{::category.name}}</label></li>
                </ul>
            </div>

            <div class="form-group" ng-if="forEvent && promocode.codeType == 'ACCESS'">
                <label>Gives access to category:</label>
                <ul class="list-unstyled">
                    <li ng-repeat="category in restrictedCategories"><label><input type="radio" ng-model="promocode.hiddenCategoryId" name="hiddenCategory" ng-value="category.id" required> {{::category.name}}</label></li>
                </ul>
            </div>

            <div class="form-group" bs-form-error="promocode.maxUsage">
                <label for="maxUsage">Limit usage to</label>
                <input type="number" data-ng-model="promocode.maxUsage" name="maxUsage" id="maxUsage" class="form-control">
                <field-error data-form-obj="promocode" data-field-obj="promocode.maxUsage" data-show-existing-errors="showExistingErrors"></field-error>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <input class="form-control" id="description" ng-model="promocode.description" name="description" maxlength="1024">
            </div>

            <div class="form-group">
                <label for="emailReference">Contact</label>
                <input type="email" class="form-control" id="emailReference" ng-model="promocode.emailReference" name="emailReference" maxlength="256">
            </div>
        </div>
    
        <div class="clearfix"></div>
    </div>

    <div class="modal-footer">
        <div class="col-md-4 col-md-push-8 col-xs-12">
            <button type="submit" class="btn btn-lg btn-warning btn-block" data-ng-disabled="promoCodeForm.$waiting || promoCodeForm.$invalid" data-ng-click="ok(formObj)" style="margin-bottom: 10px">Save</button>
        </div>
        <div class="col-md-4 col-md-pull-4 col-xs-12">
            <button type="button" class="btn btn-lg btn-default btn-block" data-ng-disabled="promoCodeForm.$waiting" data-ng-click="cancel()" style="margin-bottom: 10px">Cancel</button>
        </div>
    </div>
</form>